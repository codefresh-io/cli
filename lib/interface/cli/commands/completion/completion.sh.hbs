###-begin-{{app_name}}-completions-###
#
# codefresh command completion script
#
# Installation: {{app_path}} {{completion_command}} >> ~/.bashrc
#    or {{app_path}} {{completion_command}} >> ~/.bash_profile on OSX.
#
_codefresh_completions()
{
    local cur_word args type_list

    cur_word="${COMP_WORDS[COMP_CWORD]}"
    args=("${COMP_WORDS[@]}")

    # ask codefresh to generate completions.
    type_list=$({{app_path}} --get-yargs-completions "${args[@]}")

    COMPREPLY=( $(compgen -W "${type_list}" -- ${cur_word}) )

    # erase user input while operation runs
    export __BEFORE_PREVIOUS=$__PREVIOUS
    export __PREVIOUS=$COMPREPLY
    if [[ ${__PREVIOUS} == ${__BEFORE_PREVIOUS} ]]; then
        stty -icanon time 0 min 0
        line=$(head -n 1)
    fi

    return 0
}
complete -F _codefresh_completions {{app_name}}
###-end-{{app_name}}-completions-###
