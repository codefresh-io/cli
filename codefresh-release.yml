version: '1.0'

steps:

  build_executables:
    title: "Compiling executables"
    image: node:9.2.0
    commands:
      - "yarn install"
      - "yarn pkg"
      - "apt-get update"
      - "apt-get install -y zip jq"
      - "cd dist"
      - "tar -cf codefresh-${{CF_BRANCH}}-linux-x64.tar codefresh-linux-x64 ../README ../"
      - "gzip codefresh-${{CF_BRANCH}}-linux-x64.tar"
      - "curl https://api.github.com/repos/codefresh-io/codefresh/releases/tags/${{CF_BRANCH}} | jq -r '.id' > release-id.txt"
      - 'curl -X POST -H "Content-Type:application/octet-stream" -H "Authorization: token ${{TOKEN}}"  --data-binary @codefresh-${{CF_BRANCH}}-linux-x64.tar.gz https://uploads.github.com/repos/codefresh-io/codefresh/releases/$(cat release-id.txt)/assets?name=codefresh-${{CF_BRANCH}}-linux-x64.tar.gz'

## add to npm
